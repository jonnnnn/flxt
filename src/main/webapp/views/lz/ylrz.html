<script src="js/jquery-1.8.3.min.js"></script>
<div class="layui-fluid">
    <div class="layui-row">
        <div class="layui-col-xs12">
            <div class="layui-card">
                <div class="layui-card-body">

                    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                        <legend>录入协议</legend>
                    </fieldset>

                    <form class="layui-form"  id="formid" onsubmit="return false">

                        <div class="layui-form-item" >
                            <div class="layui-inline">
                                <label class="layui-form-label" style="width: 85px" >政策开始日期</label>
                                <div class="layui-input-inline">
                                   <span><input type="text" name="begindate" id="begindateid" readonly  lay-verify="required" autocomplete="off" class="layui-input"></span>
                                </div>
                            </div>
                            <div class="layui-inline" >
                                <label class="layui-form-label" style="width: 85px" >政策截止日期</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="enddate" id="enddateid"  readonly autocomplete="off" lay-verify="required"  class="layui-input"></span>
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item" id="G" ondblclick="seletcust(this)">
                            <div class="layui-inline" >
                                <label class="layui-form-label">供应商编码</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="supno"  readonly  autocomplete="off" lay-verify="required" class="layui-input"></span>
                                </div>
                            </div>
                            <div class="layui-inline" >
                                <label class="layui-form-label">供应商名称</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="supname" readonly  autocomplete="off" lay-verify="required" class="layui-input"></span>
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item" id="proddiv" ondblclick="seletprod()">
                            <div class="layui-inline" >
                                <label class="layui-form-label" >商品编码</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="prodno" readonly autocomplete="off" lay-verify="required" class="layui-input"></span>
                                </div>
                            </div>
                            <div class="layui-inline" >
                                <label class="layui-form-label" >商品名称</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="prodname" readonly  autocomplete="off" lay-verify="required" class="layui-input"></span>
                                </div>
                            </div>
                            <div class="layui-inline" >
                                <label class="layui-form-label">规格</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="prodspecification" readonly  autocomplete="off" class="layui-input"></span>
                                </div>
                            </div>
                            <div class="layui-inline" >
                                <label class="layui-form-label">包装单位</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="packageunit" readonly autocomplete="off" lay-verify="required" class="layui-input"></span>
                                </div>
                            </div>
                            <div class="layui-inline" >
                                <label class="layui-form-label">采购员</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="purchaser" readonly autocomplete="off"  class="layui-input"></span>
                                </div>
                            </div>
                        </div>

                        <div class="layui-form-item" >
                            <div  class="layui-inline" id="X" ondblclick="seletcust(this)">
                            <div class="layui-inline">
                                <label class="layui-form-label" >客户编码</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="custno" readonly autocomplete="off"  class="layui-input"></span>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label" >客户名称</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="custname" readonly  autocomplete="off" class="layui-input"></span>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label" >所属大区</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="ownerareatext" readonly  autocomplete="off" class="layui-input"></span>
                                </div>
                            </div>
                            </div>

                            <div class="layui-inline" id="custtypeid"  style="display: none">

                            <div class="layui-inline">
                                <label class="layui-form-label" style="width: 85px">客户类别</label>
                                <div class="layui-input-inline">
                                    <select name="custtype" id="custtypebyid">
                                        <option value=""></option>
                                    </select>
                                </div>
                            </div>

                            </div>
                            <div class="layui-inline" >
                                <div class="layui-input-inline">
                                    <input type="radio" name="swichcustidtype" lay-filter="swichcustidtype" value="cust" title="按客户" checked="" >
                                    <input type="radio" name="swichcustidtype" lay-filter="swichcustidtype" value="type" title="按类别" >
                                </div>
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">销售价</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="price"   autocomplete="off" lay-verify="number" class="layui-input"></span>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">购进价</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="getprice"   autocomplete="off" lay-verify="number" class="layui-input"></span>
                                </div>
                            </div>

                            <div class="layui-inline">
                                <label class="layui-form-label">返利单价</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="flprice"   autocomplete="off" lay-verify="number" class="layui-input"></span>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">兑付时间</label>
                                <div class="layui-input-block" style="width: 500px">
                                    <select name="dftime" lay-verify="required">
                                        <option value=""></option>
                                        <option value="月付">月付</option>
                                        <option value="季度付">季度付</option>
                                        <option value="半年付">半年付</option>
                                        <option value="60天付">60天付</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">政策类型</label>
                                <div class="layui-input-block">
                                    <input type="radio" name="fltype" value="采购政策" title="采购政策" checked="">
                                    <input type="radio" name="fltype" value="销售政策" title="销售政策" >
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">兑付方式</label>
                                <div class="layui-input-block" style="width: 500px">
                                    <select name="dftype" lay-verify="required">
                                        <option value=""></option>
                                        <option value="现金">现金</option>
                                        <option value="票折">票折</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label" style="width: 85px" >供应商联系人</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="contactsman"   autocomplete="off" class="layui-input"></span>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label" style="width: 85px" >联系人电话</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="contactsphone" lay-verify="number"  autocomplete="off" class="layui-input"></span>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">备注</label>
                                <div class="layui-input-inline">
                                    <span><input type="text" name="note"   autocomplete="off" class="layui-input"></span>
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">返利政策<br>(详细)</label>
                            <div class="layui-input-block">
                                <textarea name="flmark" placeholder="请输入内容" class="layui-textarea"></textarea>
                            </div>
                        </div>

                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button class="layui-btn" lay-submit="" lay-filter="demo1_hash"  >立即提交</button>
                        </div>
                    </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    layui.config({
        version: '1522709297490' //为了更新 js 缓存，可忽略
    });
    layui.use(['form', 'jquery','layer','laydate'], function () {
        var $ = layui.jquery,
            form = layui.form,
            layer = layui.layer;
            laydate = layui.laydate;
            form.render();

        laydate.render({
            elem: '#begindateid'
        });
        laydate.render({
            elem: '#enddateid'
        });

        //监听提交
        form.on('submit(demo1_hash)', function (data) {
            layer.confirm('确认提交？', function () {
                console.log(data.field);
                $.ajax({
                    url: 'inserYlr',
                    type:'post',
                    dataType:"json",
                    data: data.field,
                    success:function (res) {
                        layer.msg(res.msg, {time:3000});
                        if(res.msg=="保存成功！"){
                            $("#formid")[0].reset();
                            layui.form.render();
                        }

                    },error:function () {
                        layer.msg('网络错误!');
                    }
                });
            });
        });

        form.on('radio(swichcustidtype)',function (elem) {
            if(elem.value=='cust'){
                $('#X').show();
                $('#custtypebyid').empty();
                $('#custtypeid').hide();
                form.render();
            }
            if(elem.value=='type'){
                $('#custtypeid').show();
                $('#X').each(function () {
                    $(this).find("span").each(function (n) {
                        $(this).children("input").val('');
                    }) ;
                });
                $('#X').hide();
                $.post('getCusttype',function (res) {
                    if(res.success){layer.msg('网络错误');return;}
                    var list = res.data;
                    $.each(list, function (index, list) {
                        var arr = Object.values(list);
                        $('#custtypebyid').append(new Option('', ''));// 下拉菜单里添加元素
                        $('#custtypebyid').append(new Option(arr[1], arr[0]));// 下拉菜单里添加元素
                    });
                    layui.form.render();
                },'json');

            }
        });
    });


    function seletprod() {
        layui.use(['jquery','layer'], function () {
            var $ = layui.jquery,
                layer = layui.layer;
            layer.open({
                type: 2,
                title: '选择商品',
                shadeClose: true,
                shade: 0.8,
                /*  btn:['提交','关闭'],*/
                area: ['60%', '90%'],//宽 高
                content: 'views/lz/SelectProd.html',
                success:function (layero,index ) {

                }
            });
        });
    }

    function seletcust(obj) {
        layui.use(['jquery','layer'], function () {
            var $ = layui.jquery,
                layer = layui.layer;
            layer.open({
                type: 2,
                title: '选择客户',
                shadeClose: true,
                shade: 0.8,
                /*  btn:['提交','关闭'],*/
                area: ['60%', '90%'],//宽 高
                content: 'views/lz/selcust.html',
                success:function (layero,index ) {
                     var iframe = window['layui-layer-iframe'+index];
                    iframe.child(obj.id);
                }
            });
        });
    }

    /*赋客户值*/
    function getcust(custtypes,custdatas) {
        $("#"+custtypes+"").each(function () {
            $(this).find("span").each(function (n) {
                $(this).children("input").val(custdatas[n]);
            }) ;
        });
    }
   /* 赋值商品*/
    function getprod(datas) {
        $("#proddiv").each(function () {
           $(this).find("span").each(function (n) {
               $(this).children("input").val(datas[n]);
           }) ;
        });
    }


</script>


